// Generated by CoffeeScript 2.7.0
(function() {

  /*
    Renders all players on the canvas.
    Alive players shown with sprite, dead players shown as faded.
  */
  var canvas, ctx, playerImage, players, render, socket;

  socket = io();

  // Canvas setup
  canvas = document.getElementById('game-canvas');

  ctx = canvas.getContext('2d');

  canvas.width = 1200;

  canvas.height = 800;

  // Load player sprite
  playerImage = new Image();

  playerImage.src = 'https://saahild.com/oneko.gif';

  // Game state from server
  players = [];

  socket.on('connect', function() {
    return console.log('Connected to server');
  });

  socket.on('game-code', function(code) {
    console.log(`code ${code}`);
    document.querySelector('#game-code').innerText = code;
    return document.querySelector("#game-qr-code").src = `/game-qr?code=${code}`;
  });

  // Receive game state updates from server
  socket.on('game-state', function(state) {
    return players = state.players;
  });

  render = function() {
    var i, len, player;
    // Clear canvas
    ctx.fillStyle = '#0f0f23';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    for (i = 0, len = players.length; i < len; i++) {
      player = players[i];
      ctx.save();
      ctx.translate(player.x, player.y);
      if (player.alive) {
        // Draw player sprite centered
        ctx.drawImage(playerImage, -25, -25, 50, 50);
      } else {
        // Draw dead player as faded circle
        ctx.globalAlpha = 0.3;
        ctx.beginPath();
        ctx.arc(0, 0, 25, 0, Math.PI * 2);
        ctx.fillStyle = '#666';
        ctx.fill();
      }
      ctx.restore();
    }
    return requestAnimationFrame(render);
  };

  // Start render loop once image loads
  playerImage.onload = function() {
    return render();
  };

  // Fallback: start render even if image fails
  playerImage.onerror = function() {
    console.warn('Failed to load player image, using fallback');
    return render();
  };

  // Start render loop after short delay as backup
  setTimeout((function() {
    if (!players.length) {
      return render();
    }
  }), 1000);

  socket.emit("type", "server");

}).call(this);
